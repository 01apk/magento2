<?xml version="1.0"?>
<schema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:setup:Model/Declaration/Schema/etc/schema.xsd">
  <table name="queue" resource="default">
    <column xsi:type="int" name="id" padding="11" unsigned="true" nullable="false" identity="true"/>
    <column xsi:type="varchar" name="name" nullable="true" length="255"/>
    <constraint xsi:type="primary" name="PRIMARY">
      <column name="id"/>
    </constraint>
    <constraint xsi:type="unique" name="QUEUE_NAME">
      <column name="name"/>
    </constraint>
  </table>
  <table name="queue_message" resource="default">
    <column xsi:type="bigint" name="id" padding="20" unsigned="true" nullable="false" identity="true"/>
    <column xsi:type="varchar" name="topic_name" nullable="true" length="255"/>
    <column xsi:type="longtext" name="body" nullable="true"/>
    <constraint xsi:type="primary" name="PRIMARY">
      <column name="id"/>
    </constraint>
  </table>
  <table name="queue_message_status" resource="default">
    <column xsi:type="bigint" name="id" padding="20" unsigned="true" nullable="false" identity="true"/>
    <column xsi:type="int" name="queue_id" padding="11" unsigned="true" nullable="false" identity="false"/>
    <column xsi:type="bigint" name="message_id" padding="20" unsigned="true" nullable="false" identity="false"/>
    <column xsi:type="timestamp" name="updated_at" on_update="true" nullable="false" default="CURRENT_TIMESTAMP"/>
    <column xsi:type="smallint" name="status" padding="6" unsigned="true" nullable="false" identity="false"/>
    <column xsi:type="smallint" name="number_of_trials" padding="6" unsigned="true" nullable="false" identity="false" default="0"/>
    <constraint xsi:type="primary" name="PRIMARY">
      <column name="id"/>
    </constraint>
    <constraint xsi:type="foreign" name="QUEUE_MESSAGE_ID_QUEUE_MESSAGE_STATUS_MESSAGE_ID" table="queue_message_status" column="message_id" referenceTable="queue_message" referenceColumn="id" onDelete="CASCADE"/>
    <constraint xsi:type="foreign" name="QUEUE_ID_QUEUE_MESSAGE_STATUS_QUEUE_ID" table="queue_message_status" column="queue_id" referenceTable="queue" referenceColumn="id" onDelete="CASCADE"/>
    <constraint xsi:type="unique" name="QUEUE_MESSAGE_STATUS_QUEUE_ID_MESSAGE_ID">
      <column name="queue_id"/>
      <column name="message_id"/>
    </constraint>
    <index name="QUEUE_MESSAGE_STATUS_STATUS_UPDATED_AT" indexType="btree">
      <column name="status"/>
      <column name="updated_at"/>
    </index>
  </table>
</schema>

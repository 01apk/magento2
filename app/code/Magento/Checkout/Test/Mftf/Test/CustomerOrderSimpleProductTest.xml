<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="CustomerOrderSimpleProductTest">
        <annotations>
            <features value="Checkout"/>
            <stories value="Customer Order Simple Product"/>
            <title value="Customer Order Simple Product"/>
            <description value="Customer Order Simple Product"/>
            <stories value="Customer Checkout"/>
            <severity value="MAJOR"/>
            <group value="checkout"/>
            <group value="shoppingCart"/>
        </annotations>
        <before>
            <!-- create category -->
            <createData entity="_defaultCategory" stepKey="testCategory"/>
            <!-- create data -->
            <createData entity="_defaultProduct" stepKey="testProduct">
                <requiredEntity createDataKey="testCategory"/>
            </createData>
            <!-- Assign Product to Category -->
            <createData entity="AssignProductToCategory" stepKey="assignTestCategoryToTestProduct">
                <requiredEntity createDataKey="testCategory"/>
                <requiredEntity createDataKey="testProduct"/>
            </createData>
            <!-- create customer -->
            <createData entity="CustomerEntityOne" stepKey="createCustomer"/>
        </before>

        <after>
            <!-- delete category,product,customer -->
            <deleteData createDataKey="testProduct" stepKey="deleteSimpleProduct"/>
            <deleteData createDataKey="testCategory" stepKey="deleteSimpleCategory"/>
            <deleteData createDataKey="createCustomer" stepKey="deleteGloCustomer"/>
        </after>
        <!-- Login as customer -->
        <actionGroup ref="LoginToStorefrontActionGroup" stepKey="storefrontCustomerLogin">
            <argument name="Customer" value="$$createCustomer$$"/>
        </actionGroup>
        <!-- Go to category -->
        <actionGroup ref="StorefrontNavigateCategoryPageActionGroup" stepKey="navigateToCategoryPage">
            <argument name="category" value="$$testCategory$$"/>
        </actionGroup>
        <waitForPageLoad stepKey="waitForCatalogPageLoad"/>


        <!-- Open product detail page-->
        <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($testProduct.name$)}}" stepKey="openProduct"/>
        <waitForPageLoad time="30" stepKey="waitForFirstProduct"/>

        <!-- add to cart -->
        <actionGroup ref="AddToCartFromStorefrontProductPageActionGroup" stepKey="addToCartFromStorefrontProductPage">
            <argument name="productName" value="$$testProduct.name$$"/>
        </actionGroup>

        <!-- click on cart icon and proceed to checkout -->
        <actionGroup ref="GoToCheckoutFromMinicartActionGroup" stepKey="goToCheckoutFromMinicart"/>


        <!-- Steps to perform checkout -->
        <actionGroup ref="StorefrontGuestCheckoutProceedToPaymentStepActionGroup" stepKey="clickNext"/>
        <waitForElement selector="{{CheckoutPaymentSection.paymentSectionTitle}}" stepKey="waitForPaymentSectionLoaded"/>
        <waitForElementVisible selector="{{CheckoutPaymentSection.placeOrder}}" stepKey="waitForPlaceOrderButton"/>

        <waitForElement selector="{{CheckoutPaymentSection.paymentSectionTitle}}" time="30" after="clickNext" stepKey="waitForPaymentSectionLoaded2"/>
        <conditionalClick selector="{{CheckoutPaymentSection.checkMoneyOrderPayment}}" dependentSelector="{{CheckoutPaymentSection.billingAddress}}" visible="false" before="waitForPlaceOrderButton" stepKey="clickCheckMoneyOrderPayment"/>

        <click selector="{{CheckoutPaymentSection.placeOrder}}" stepKey="clickPlaceOrderButton"/>
        <seeElement selector="{{CheckoutSuccessMainSection.success}}" stepKey="orderIsSuccessfullyPlaced"/>

        <!-- order number is captured for future validation -->
        <grabTextFrom selector="{{CheckoutSuccessMainSection.orderNumber22}}" stepKey="getOrderNumber"/>
    </test>
</tests>

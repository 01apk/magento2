<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AddNewProductAttributeInProductPageTest">
        <annotations>
            <stories value="Create product Attribute"/>
            <title value="Create Product Attribute from Product Page"/>
            <description value="Login as admin and create new product attribute from product page with Text Field"/>
            <severity value="BLOCKER"/>
            <testCaseId value="MC-26654"/>
            <group value="mtf_migrated"/>
        </annotations>

        <before>
            <!-- Login as admin -->
            <actionGroup ref="AdminLoginActionGroup" stepKey="login"/>

            <!--Create Category-->
            <createData entity="SimpleSubCategory" stepKey="createCategory"/>

            <!--Create Simple Product-->
            <createData entity="SimpleProduct" stepKey="createSimpleProduct">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
        </before>
        <after>
            <!--Delete created entity -->
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>

            <!--<deleteData createDataKey="createSimpleProduct" stepKey="deleteSimpleProduct"/>-->
            <actionGroup ref="DeleteProductAttributeActionGroup" stepKey="deleteCreatedAttribute">
                <argument name="ProductAttribute" value="newProductAttribute"/>
            </actionGroup>

            <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
        </after>

        <!-- Open Product Index Page-->
        <actionGroup ref="AdminOpenProductIndexPageActionGroup" stepKey="navigateToProductIndex"/>

        <!-- Select Created Product-->
        <actionGroup ref="FilterProductGridBySkuActionGroup" stepKey="filterProductGridBySku">
            <argument name="product" value="$$createSimpleProduct$$"/>
        </actionGroup>
        <click stepKey="openFirstProduct" selector="{{AdminProductGridSection.productRowBySku($$createSimpleProduct.sku$$)}}"/>
        <waitForPageLoad stepKey="waitForProductToLoad"/>

        <fillField selector="{{AdminProductFormSection.productQuantity}}" userInput="100" stepKey="fillProductQty"/>
        <actionGroup ref="AdminSetStockStatusActionGroup" stepKey="selectStockStatus">
            <argument name="stockStatus" value="In Stock"/>
        </actionGroup>

        <!-- Create New Product Attribute -->
        <actionGroup ref="AddProductAttributeActionGroup" stepKey="createattribute"/>

        <actionGroup ref="AdminProductFormSaveButtonClickActionGroup" stepKey="saveTheProduct"/>
        <see selector="{{AdminCategoryMessagesSection.SuccessMessage}}" userInput="You saved the product." stepKey="messageYouSavedTheProductIsShown"/>

        <!--Verify product attribute added in product form -->
        <scrollTo selector="{{AdminProductFormSection.contentTab}}" stepKey="scrollToContentTab"/>
        <waitForElementVisible selector="{{AdminProductFormSection.attributeTab}}" stepKey="waitForAttributeToVisible"/>
        <click selector="{{AdminProductFormSection.attributeTab}}" stepKey="clickOnAttribute"/>
        <seeElement selector="{{AdminProductFormSection.attributeLabelByText(ProductAttributeFrontendLabel.label)}}" stepKey="seeAttributeLabelInProductForm"/>

        <!--Verify Product Attribute in Attribute Form -->
        <actionGroup ref="AdminOpenProductAttributePageActionGroup" stepKey="navigateToProductAttributeGrid"/>
        <fillField selector="{{AdminProductAttributeGridSection.FilterByAttributeCode}}" userInput="{{newProductAttribute.attribute_code}}" stepKey="setAttributeCode"/>
        <click selector="{{AdminProductAttributeGridSection.Search}}" stepKey="searchForAttributeFromTheGrid"/>
        <waitForPageLoad stepKey="waitForPageLoad" />
        <see selector="{{AdminProductAttributeGridSection.attributeCodeColumn}}" userInput="{{newProductAttribute.attribute_code}}" stepKey="seeAttributeCode"/>
        <see selector="{{AdminProductAttributeGridSection.defaultLabelColumn}}" userInput="{{ProductAttributeFrontendLabel.label}}" stepKey="seeDefaultLabel"/>
        <see selector="{{AdminProductAttributeGridSection.isVisibleColumn}}" userInput="Yes" stepKey="seeIsVisibleColumn"/>
        <see selector="{{AdminProductAttributeGridSection.isSearchableColumn}}" userInput="Yes" stepKey="seeSearchableColumn"/>
        <see selector="{{AdminProductAttributeGridSection.isComparableColumn}}" userInput="Yes" stepKey="seeComparableColumn"/>

        <!--Verify Product Attribute is present in Category Store Front Page -->
        <amOnPage url="$$createCategory.custom_attributes[url_key]$$.html" stepKey="goToStorefrontPage"/>
        <waitForPageLoad stepKey="waitForProductFrontPageToLoad"/>
        <click selector="{{StorefrontHeaderSection.NavigationCategoryByName(SimpleSubCategory.name)}}" stepKey="clickOnCategory"/>
        <waitForPageLoad stepKey="waitForCategoryPageToLoad"/>
        <click selector="{{StorefrontCategoryMainSection.productLink}}" stepKey="openSearchedProduct"/>
        <waitForPageLoad  stepKey="waitForProductToLoad1"/>
        <see selector="{{StorefrontProductInfoMainSection.productName}}" userInput="{{SimpleProduct.name}}" stepKey="seeProductNameInStoreFront"/>
        <see selector="{{StorefrontProductInfoMainSection.productPrice}}" userInput="{{SimpleProduct.price}}" stepKey="seeProductPriceInStoreFront"/>
        <actionGroup ref="StorefrontAssertProductSkuOnProductPageActionGroup" stepKey="seeProductSkuInStoreFront">
            <argument name="productSku" value="{{SimpleProduct.sku}}"/>
        </actionGroup>
        <scrollTo selector="{{StorefrontProductMoreInformationSection.moreInformation}}" stepKey="scrollToMoreInformation"/>
        <see selector="{{StorefrontProductMoreInformationSection.attributeLabel}}"  userInput="{{ProductAttributeFrontendLabel.label}}" stepKey="seeAttributeLabel"/>
        <see selector="{{StorefrontProductMoreInformationSection.attributeValue}}"  userInput="{{ProductAttributeOption8.value}}" stepKey="seeAttributeValue"/>

        <!--Verify Product Attribute present in search page -->
        <amOnPage url="$$createCategory.custom_attributes[url_key]$$.html" stepKey="goToStorefrontPage1"/>
        <waitForPageLoad stepKey="waitForProductFrontPageToLoad1"/>
        <actionGroup ref="StorefrontCheckQuickSearchStringActionGroup" stepKey="fillAttribute">
            <argument name="phrase" value="{{ProductAttributeOption8.value}}"/>
        </actionGroup>
        <actionGroup ref="StorefrontAssertProductNameOnProductMainPageActionGroup" stepKey="seeProductNameInCategoryPage">
            <argument name="productName" value="{{SimpleProduct.name}}"/>
        </actionGroup>
    </test>
</tests>


<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AdminCheckResultsOfColorAndOtherFiltersTest">
        <annotations>
            <features value="LayeredNavigation"/>
            <stories value="Checking filters results"/>
            <title value="Checking results of color and other filters"/>
            <description value="Checking results of filters: color and other filters"/>
            <severity value="MAJOR"/>
            <testCaseId value="MC-6192"/>
            <useCaseId value="MAGETWO-91753"/>
            <group value="layeredNavigation"/>
        </annotations>
        <before>
            <!-- Login as Admin -->
            <comment userInput="Login as Admin" stepKey="commentLoginAsAdmin"/>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <!-- Create default category with subcategory -->
            <comment userInput="Create default category with subcategory" stepKey="commentCreateCategory"/>
            <createData entity="ApiCategory" stepKey="createCategory"/>
            <createData entity="SubCategoryWithParent" stepKey="createSubcategory">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <!-- Add first attribute with options -->
            <comment userInput="Add first attribute with options" stepKey="commentAddFirstAttribute"/>
            <amOnPage url="{{AdminProductAttributeGridPage.url}}" stepKey="goToProductAttributes"/>
            <waitForPageLoad stepKey="waitForProductAttributes"/>
            <actionGroup ref="CreateAttributeWithOptions" stepKey="createAttribute">
                <argument name="labelName" value="color2"/>
                <argument name="inputType" value="Dropdown"/>
                <argument name="firstOption" value="red"/>
                <argument name="secondOption" value="green"/>
                <argument name="thirdOption" value="blue"/>
                <argument name="fourthOption" value="brown"/>
                <argument name="fifthOption" value="black"/>
                <argument name="useInLayer" value="Filterable (with results)"/>
            </actionGroup>
            <!-- Add second attribute with options-->
            <comment userInput="Add second attribute with options" stepKey="commentAddSecondAttribute"/>
            <amOnPage url="{{AdminProductAttributeGridPage.url}}" stepKey="goToProductAttributes2"/>
            <actionGroup ref="CreateNewAttributeWithOptions" stepKey="createSecondAttribute">
                <argument name="labelName" value="material"/>
                <argument name="inputType" value="Multiple Select"/>
                <argument name="firstOption" value="cotton"/>
                <argument name="secondOption" value="fabric"/>
                <argument name="thirdOption" value="jeans"/>
                <argument name="fourthOption" value="synthetic"/>
                <argument name="useInLayer" value="Filterable (with results)"/>
            </actionGroup>
            <actionGroup ref="AddUnsignedAttributeToGroup" stepKey="createDefaultAttributeSet">
                <argument name="label" value="mySet"/>
                <argument name="firstOption" value="color2"/>
                <argument name="secondOption" value="material"/>
                <argument name="group" value="Product Details"/>
            </actionGroup>
            <!-- Create three configurable products with options -->
            <comment userInput="Create three configurable products with options" stepKey="commentCreateConfigurableProducts"/>
            <amOnPage url="{{AdminProductIndexPage.url}}" stepKey="amOnProductGridPage"/>
            <waitForPageLoad time="30" stepKey="wait1"/>
            <click selector="{{AdminProductGridActionSection.addProductToggle}}" stepKey="clickOnAddProductToggle"/>
            <click selector="{{AdminProductGridActionSection.addConfigurableProduct}}" stepKey="clickOnAddConfigurableProduct"/>
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createProduct1">
                <argument name="product" value="ConfigurableProductWithAttributeSet1"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['jeans', 'synthetic', 'cotton', 'fabric']"/>
            </actionGroup>
            <actionGroup ref="CreateConfigurationsForOptions" stepKey="createConfigurations1">
                <argument name="option2" value="color2"/>
                <argument name="price" value="34"/>
                <argument name="sku" value="1000"/>
            </actionGroup>
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createProduct2">
                <argument name="product" value="ConfigurableProductWithAttributeSet2"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['jeans','cotton', 'fabric']"/>
            </actionGroup>
            <actionGroup ref="CreateConfigurableProductWithAttributeSetAndOption" stepKey="createConfigurations2">
                <argument name="option2" value="color2"/>
                <argument name="price" value="34"/>
                <argument name="sku" value="111"/>
                <argument name="colorOption" value="black"/>
            </actionGroup>
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createProduct3">
                <argument name="product" value="ConfigurableProductWithAttributeSet3"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['jeans','synthetic', 'fabric']"/>
            </actionGroup>
            <actionGroup ref="CreateConfigurableProductWithAttributeSetAndOption" stepKey="createConfigurations3">
                <argument name="option2" value="color2"/>
                <argument name="price" value="34"/>
                <argument name="sku" value="222"/>
                <argument name="colorOption" value="red"/>
            </actionGroup>
            <!-- Create Simple product with options -->
            <comment userInput="Create Simple product with options" stepKey="commentCreateProduct"/>
            <actionGroup ref="CreateConfigurableProductWithAttributeSet" stepKey="createSimpleProduct">
                <argument name="product" value="Simple1"/>
                <argument name="category" value="$$createCategory$$"/>
                <argument name="label" value="mySet"/>
                <argument name="option1" value="['cotton', 'fabric']"/>
            </actionGroup>
            <click selector="{{AdminGridMainControls.save}}" stepKey="clickToSave"/>
            <waitForPageLoad stepKey="waitForNewSimpleProductPage"/>
            <seeElement selector="{{AdminProductMessagesSection.successMessage}}" stepKey="seeSaveProductMessage"/>
            <!-- Open a category on storefront -->
            <comment userInput="Open a category on storefront" stepKey="commentOpenCategoryOnStorefront"/>
            <actionGroup ref="StorefrontGoToCategoryPageActionGroup" stepKey="goToCategoryPage">
                <argument name="categoryName" value="$$createCategory.name$$"/>
            </actionGroup>
            <!-- Choose color filter -->
            <comment userInput="Choose color filter" stepKey="commentChooseColorFilter"/>
            <waitForElementVisible selector="{{StorefrontCategorySidebarSection.filterOptionTitle('color2')}}" stepKey="waitForCartRuleButton"/>
            <click selector="{{StorefrontCategorySidebarSection.filterOptionTitle('color2')}}" stepKey="expandColorAttribute"/>
            <waitForPageLoad stepKey="waitForFilterLoad"/>
            <click selector="{{StorefrontCategorySidebarSection.filterOptionContent('green')}}" stepKey="expandGreenAttribute"/>
            <see userInput="Pants" stepKey="seeFirstProduct"/>
            <see userInput="Cardigan" stepKey="seeSecondProduct"/>
            <see userInput="Jacket" stepKey="seeThirdProduct"/>
            <actionGroup ref="StorefrontGoToCategoryPageActionGroup" stepKey="goToCategoryPageAgain">
                <argument name="categoryName" value="$$createCategory.name$$"/>
            </actionGroup>
            <!-- Choose material filter -->
            <comment userInput="Choose material filter" stepKey="commentChooseMaterialFilter"/>
            <click selector="{{StorefrontCategorySidebarSection.filterOptionTitle('material')}}" stepKey="expandMaterialAttribute"/>
            <waitForPageLoad stepKey="waitForFilterPageLoad"/>
            <click selector="{{StorefrontCategorySidebarSection.filterOptionContent('cotton')}}" stepKey="expandCottonAttribute"/>
            <see userInput="Cardigan" stepKey="seeFourthProduct"/>
            <see userInput="Jacket" stepKey="seeFifthProduct"/>
        </before>
        <after>
            <!-- Delete created data -->
            <comment userInput="Delete created data" stepKey="commentDeleteData"/>
            <amOnPage url="{{AdminProductAttributeSetGridPage.url}}" stepKey="goToAttributeSets"/>
            <waitForPageLoad stepKey="wait1"/>
            <fillField selector="{{AdminProductAttributeSetGridSection.filter}}" userInput="{{ConfigurableProductWithAttributeSet1.attribute_set_name}}" stepKey="filterByName"/>
            <click selector="{{AdminProductAttributeSetGridSection.searchBtn}}" stepKey="clickSearch"/>
            <click selector="{{AdminProductAttributeSetGridSection.nthRow('1')}}" stepKey="clickFirstRow"/>
            <waitForPageLoad stepKey="wait2"/>
            <click selector="{{AdminProductAttributeSetSection.deleteBtn}}" stepKey="delete"/>
            <click selector="{{AdminProductAttributeSetSection.modalOk}}" stepKey="confirmDelete"/>
            <waitForPageLoad stepKey="wait3"/>
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
            <actionGroup ref="AdminOpenProductIndexPageActionGroup" stepKey="navigateToProductIndexPage"/>
            <actionGroup ref="deleteProductsIfTheyExist" stepKey="deleteAllProducts"/>
            <actionGroup ref="navigateToEditProductAttribute" stepKey="goToEditPageAgain">
                <argument name="ProductAttribute" value="color2"/>
            </actionGroup>
            <click stepKey="clickDelete" selector="{{AttributePropertiesSection.DeleteAttribute}}"/>
            <click stepKey="clickOk" selector="{{AttributeDeleteModalSection.confirm}}"/>
            <waitForPageLoad stepKey="waitForDeletionAttribute"/>
            <actionGroup ref="navigateToEditProductAttribute" stepKey="goToEditPageAttribute">
                <argument name="ProductAttribute" value="material"/>
            </actionGroup>
            <click stepKey="clickDeleteAgain" selector="{{AttributePropertiesSection.DeleteAttribute}}"/>
            <click stepKey="clickOkForTheSecondTime" selector="{{AttributeDeleteModalSection.confirm}}"/>
            <waitForPageLoad stepKey="waitForDeletion"/>
            <!-- Log out -->
            <comment userInput="Log out" stepKey="commentLogOut"/>
            <actionGroup ref="logout" stepKey="logout"/>
        </after>
    </test>
</tests>

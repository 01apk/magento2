<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="CreateAnAdminOrderUsingBraintreePaymentTest1">
        <annotations>
            <features value="Backend"/>
            <stories value="Creation an admin order using Braintree payment"/>
            <title value="Create order using Braintree payment"/>
            <description value="Admin should be able to create order using Braintree payment"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-93677"/>
            <group value="braintree"/>
            <skip>
                <issueId value="MQE-1187" />
            </skip>
        </annotations>

        <before>
            <!--Login As Admin-->
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
            <!--CreateNewProduct-->
            <actionGroup ref="CreateNewProductActionGroup" stepKey="CreateNewProduct"/>
            <!--Create New Customer-->
            <actionGroup ref="CreateCustomerActionGroup" stepKey="CreateCustomer"/>
        </before>

        <!--Configure Braintree-->
        <actionGroup ref="ConfigureBraintree" stepKey="configureBraintree"/>

        <!--Create New Role-->
        <actionGroup ref="AdminCreateRoleActionGroup" stepKey="adminCreateRole">
            <argument name="restrictedRole" value="Sales"/>
            <argument name="User" value="adminRole"/>
        </actionGroup>

        <!--Create new admin user-->
        <actionGroup ref="AdminCreateUserActionGroup" stepKey="adminCreateUser">
            <argument name="role" value="adminRole"/>
        </actionGroup>

        <!--Log out-->
        <actionGroup ref="SignOut" stepKey="SignOut"/>
        <!--Log in as new user-->
        <actionGroup ref="LoginAsAnyUser" stepKey="LoginActionGroup">
            <argument name="uname" value="{{newAdmin.username}}"/>
            <argument name="passwd" value="{{newAdmin.password}}"/>
        </actionGroup>

        <!--Create New Order-->
        <actionGroup ref="CreateNewOrderActionGroup" stepKey="createNewOrder"/>

        <after>
            <!--SignOut-->
            <actionGroup ref="SignOut" stepKey="signOutFromNewUser"/>
            <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>

            <!--Delete Product-->
            <actionGroup ref="DeleteProductActionGroup" stepKey="DeleteAllProducts">
                <argument name="productName" value="NewProductData.ProductName"/>
            </actionGroup>

            <!--Delete Customer-->
            <actionGroup ref="DeleteCustomerActionGroup" stepKey="DeleteCustomer">
                <argument name="lastName" value="NewCustomerData.LastName"/>
            </actionGroup>

            <!--Delete created user-->
            <actionGroup ref="DeleteCreatedUserActionGroup" stepKey="AdminDeleteUserActionGroup">
                <argument name="user" value="adminRole"/>
            </actionGroup>
            <!--Delete created role-->
            <actionGroup ref="AdminDeleteCreatedRoleActionGroup" stepKey="AdminDeleteRoleActionGroup">
                <argument name="role" value="adminRole"/>
            </actionGroup>
            <!--Log Out-->
            <actionGroup ref="logout" stepKey="logOut2"/>
        </after>
    </test>
</tests>

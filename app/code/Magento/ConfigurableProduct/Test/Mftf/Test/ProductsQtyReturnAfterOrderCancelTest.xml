<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="">

        <annotations>
            <features value="ConfigurableProduct"/>
            <stories value="Cancel order"/>
            <title value="Product quantity return after order cancel"/>
            <description value="Check Product quantity return after order cancel"/>
            <severity value="CRITICAL"/>
            <testCaseId value="MAGETWO-97228"/>
            <useCaseId value="MAGETWO-82221"/>
            <group value="ConfigurableProduct"/>
        </annotations>

        <before>
            <createData entity="ApiCategory" stepKey="createCategory"/>
            <createData entity="BaseConfigurableProduct" stepKey="createConfigProduct">
                <requiredEntity createDataKey="createCategory"/>
                <field key="quantity">1000</field>
            </createData>

            

            <actionGroup ref="AdminLoginActionGroup" stepKey="login"/>
        </before>

        <after>
            <!-- <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
            <deleteData createDataKey="createConfigProduct" stepKey="deleteConfigProduct"/> -->
            <actionGroup ref="AdminLogoutActionGroup" stepKey="amOnLogoutPage"/>
        </after>

        <actionGroup ref="AdminOpenCatalogProductPageActionGroup" stepKey="goToCatalogProductPage1"/>

        <actionGroup ref="ClearFiltersAdminProductGridActionGroup" stepKey="clickClearFiltersInitial"/>
        <actionGroup ref="OpenEditProductOnBackendActionGroup" stepKey="openEditProduct">
            <argument name="product" value="$$createConfigProduct$$"/>
        </actionGroup>
        <fillField selector="{{AdminProductFormSection.productQuantity}}" userInput="100" stepKey="changeProductQuantity"/>
        <actionGroup ref="AdminProductFormSaveActionGroup" stepKey="saveChanges"/> 

        <createData entity="GuestCart" stepKey="createGuestCart"/>
            <createData entity="SimpleFourCartItems" stepKey="addCartItem">
                <requiredEntity createDataKey="createGuestCart"/>
                <requiredEntity createDataKey="createConfigProduct"/>
            </createData>
            <createData entity="GuestAddressInformation" stepKey="addGuestOrderAddress">
                <requiredEntity createDataKey="createGuestCart"/>
            </createData>
            <updateData createDataKey="createGuestCart" entity="GuestOrderPaymentMethod" stepKey="sendGuestPaymentInformation">
                <requiredEntity createDataKey="createGuestCart"/>
        </updateData> 

        <!-- <amOnPage url="$$createConfigProduct.sku$$.html" stepKey="navigateToProductPage"/>
        <waitForPageLoad stepKey="waitForProductPage"/>
        <fillField selector="{{StorefrontProductInfoMainSection.qty}}" userInput="4" stepKey="fillQuantity"/>

        <actionGroup ref="AddToCartFromStorefrontProductPageActionGroup" stepKey="addToCartFromStorefrontProductPage">
            <argument name="productName" value="$$createConfigProduct.name$$"/>
        </actionGroup>

        <actionGroup ref="GoToCheckoutFromMinicartActionGroup" stepKey="goToCheckoutFromMinicart"/>
        <actionGroup ref="GuestCheckoutFillingShippingSectionActionGroup" stepKey="guestCheckoutFillingShippingSection">
            <argument name="customerVar" value="CustomerEntityOne"/>
            <argument name="customerAddressVar" value="CustomerAddressSimple"/>
        </actionGroup>

        <actionGroup ref="CheckoutPlaceOrderActionGroup" stepKey="placeOrder">
            <argument name="orderNumberMessage" value="CONST.successGuestCheckoutOrderNumberMessage"/>
            <argument name="emailYouMessage" value="CONST.successCheckoutEmailYouMessage" />
        </actionGroup>

        <grabTextFrom selector="{{CheckoutSuccessMainSection.orderNumber}}" stepKey="grabOrderNumber"/> -->

        <actionGroup ref="FilterOrderGridByIdActionGroup" stepKey="filterOrderGridById">
            <argument name="orderId" value="$createGuestCart.return$"/>
        </actionGroup>

        <actionGroup ref="AdminOrderGridClickFirstRowActionGroup" stepKey="clickOrderRow"/>
        <actionGroup ref="AdminClickInvoiceButtonOrderViewActionGroup" stepKey="clickInvoiceButton"/>
        <fillField selector="{{AdminInvoiceItemsSection.qtyToInvoiceColumn}}" userInput="1" stepKey="ChangeQtyToInvoice"/>
        <click selector="{{AdminInvoiceItemsSection.updateQty}}" stepKey="updateQuantity"/>
        <waitForPageLoad stepKey="waitPageToBeLoaded"/>
        <actionGroup ref="AdminInvoiceClickSubmitActionGroup" stepKey="clickSubmitInvoice"/>
        <!-- <click selector="{{AdminOrderDetailsMainActionsSection.ship}}" stepKey="clickShipAction"/>
        <waitForPageLoad stepKey="waitOrderDetailToLoad"/> -->
        <!-- <fillField selector="{{AdminShipmentItemsSection.itemQtyToShip('1')}}" userInput="1" stepKey="changeItemQtyToShip"/> -->
        <actionGroup ref="AdminCreateShipmentFromOrderPage" stepKey="clickSubmitShipment">   
             <argument name="Qty" value="1"/>
             <argument name="Number" value="111"/>
        </actionGroup>     
       
        <!-- <click selector="{{AdminShipmentMainActionsSection.submitShipment}}" stepKey="clickSubmitShipment"/>
        <waitForPageLoad stepKey="waitShipmentSectionToLoad"/> -->
        <actionGroup ref="CancelPendingOrderActionGroup" stepKey="cancelPendingOption">
            <argument name="orderStatus" value="Complete"/>
        </actionGroup>

        <see selector="{{AdminOrderItemsOrderedSection.itemQty('1')}}" userInput="Canceled 3" stepKey="seeCanceledQuantity"/>

        <actionGroup ref="AdminOpenCatalogProductPageActionGroup" stepKey="goToCatalogProductPage"/>

        <actionGroup ref="FilterProductGridBySku2ActionGroup" stepKey="filterProductGridBySku">
            <argument name="sku" value="$$createConfigProduct.sku$$"/>
        </actionGroup>
        <actionGroup ref="AssertAdminProductGridCellActionGroup" stepKey="seeProductSkuInGrid">
            <argument name="row" value="1"/>
            <argument name="column" value="Quantity"/>
            <argument name="value" value="99"/>
        </actionGroup>
        <actionGroup ref="AdminClearFiltersActionGroup" stepKey="clearProductFilters"/>
        <actionGroup ref="AdminOrdersGridClearFiltersActionGroup" stepKey="clearOrderFilters"/>
    </test>
</tests>
